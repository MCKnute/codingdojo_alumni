<html lang="en">
<head>
  <title>CodingDojo Alumni</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="/static/css/custom.css">

  <meta name="author" content="Mike Bogosian, Peter Kang, Mollie Knute, Rich Whybrew">

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-route.min.js"></script>
  <script>

  	var alumniApp = angular.module('alumniApp', ['ngRoute']);

////CONTROLLERS /////////
    alumniApp.config(function ($routeProvider) {
      $routeProvider
        .when('/', {
            templateUrl: "static/partials/loginTest.html",
            controller: "loginController"
         })

         .when('/new-job', {
            templateUrl: "static/partials/addjobtest.html",
            controller: "jobController"
         })
         .when('/new-event', {
            templateUrl: "static/partials/addeventtest.html",
            controller: "eventController"
         })
         .when('/userUpdate', {
            templateUrl: "static/partials/userupdatetest.html",
            controller: "updateController"
         })
         .when('/users', {
            templateUrl: "static/partials/userprofilestest.html",
            controller: "profileController"
         })

    });
    //  build the controllers
    alumniApp.controller('jobController', jobController )
    alumniApp.controller('eventController', eventController )
    alumniApp.controller('updateController', updateController )
    alumniApp.controller('profileController', profileController )
    alumniApp.controller('loginController', loginController )
    

    alumniApp.factory('eventFactory', eventFactory)
    alumniApp.factory('jobFactory', jobFactory)
    alumniApp.factory('userFactory', userFactory)
    alumniApp.factory('loginFactory', loginFactory)


    function loginFactory($http, $location){
        var factory = {};
        var currentUser = null;
        console.log(currentUser);

      //a method to get the user if there is one!
        factory.getUser = function(callback){
            if(currentUser) callback(currentUser);
            else{
              //redirect to the root!
              // $location.path('/');
            }
        }

        factory.login = function(user, callback) {
            $http.post('/login', user).then(function(response){
                console.log(response.data);
                currentUser = response.data;
                console.log(currentUser);
              callback();
            })
        } 

        factory.getId = function(callback){
            $http.get('/userId').then(function(output){
                
                userId = output.data;
                console.log(userId);
                return
                callback(userId);
            })
        }    

    return factory;
    }


    function userFactory($http){
        var factory = {};
        // var currentUser = {
        //   firstName = "Mike",
        //   lastName = "Bogosian"
        // }


        factory.getJobs = function(callback){
            $http.get('/profile').then(function(output){
                
                jobs = output.data;
                // console.log(jobs);
                callback(jobs);
            })
        }

        factory.getUsers = function(callback){
            $http.get('/user').then(function(output){
                
                users = output.data;
                // console.log(users);
                callback(users);
            })
        }

         factory.getStacks = function(callback){
            $http.get('/stacks').then(function(output){
                
                stacks = output.data;
                console.log(jobs);
                callback(stacks);
            })
        }

        factory.getLocations = function(callback){
            $http.get('/locations').then(function(output){
                
                locations = output.data;
                // console.log(locations);
                callback(locations);
            })
        }

        factory.getJobStatus = function(callback){
            $http.get('/status').then(function(output){
                
                stacks = output.data;
                console.log(jobs);
                callback(stacks);
            })
        }

        factory.createUser = function(data, callback) {
            console.log(data);
            $http.post('/user', data).then(function(response){
                

              callback();
            })
        } 


    return factory;
    }

    function jobFactory($http){
        var factory = {};

        factory.getJobs = function(callback){
            $http.get('/job').then(function(output){
                
                jobs = output.data;
                // console.log(jobs);
                callback(jobs);
            })
        }

         factory.getStacks = function(callback){
            $http.get('/stacks').then(function(output){
                
                stacks = output.data;
                // console.log(jobs);
                callback(stacks);
            })
        }

        factory.createJob = function(data, callback) {
            console.log(data);
            $http.post('/job', data).then(function(response){
                

              callback();
            })
        } 


    return factory;
    }

    function eventFactory($http){
        var factory = {};

        factory.getEvents = function(callback){
            $http.get('/event').then(function(output){
                
                events = output.data;
                console.log(events);
                callback(events);
            })
        }

        factory.createEvent = function(data, callback) {
            console.log(data);
            $http.post('/event', data).then(function(response){

              callback();
            })
        } 


    return factory;
    }

    function loginController(loginFactory, $location, $scope){

        $scope.login = function(user){
            loginFactory.login(user, function(){

            loginFactory.getUser(function(user){
            // console.log(user);
            $location.path('/userUpdate');

            })

         })

        }

    }

     function updateController(userFactory, loginFactory, jobFactory, $scope, $location){

      $scope.newJob = {};
      $scope.newUser = {};
      $scope.stacks = [];
      $scope.locations = [];
      console.log($scope.login);

      function getCurrentUser(){
        loginFactory.getUser(function(data){
          $scope.currentUser = data;
          console.log($scope.currentUser, "this is coming from updateController")
        })
      }

      getCurrentUser();

      console.log($scope.currentUser)



      

      function getUsers(){

          userFactory.getUsers(function(data){
              // console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.users = data; 
            })
          
      }
      getUsers();
      function getJobs(){
          jobFactory.getJobs(function(data){
              // console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.jobs = data; // $scope.users makes 'users' object available to be used in the html with ng-repeat. This also gets updated anytime a new user is added.
            })

      }
      getJobs();
      function getStacks(){

          jobFactory.getStacks(function(data){
              // console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.stacks = data; 
              // console.log($scope.stacks[0].name)
              $scope.newUser.primaryStack = $scope.stacks[0].name
             
            })
          
      }
      getStacks();

      function getLocations(){

          userFactory.getLocations(function(data){
              // console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.locations = data; 
              // console.log($scope.locations)
              // console.log($scope.locations[0].name)
              // console.log($scope.newUser)
              $scope.newUser.primaryLocation = $scope.locations[0].name
             
            })
          
      }
      getLocations();

      $scope.addUser = function(newUser){
          console.log(newUser);
           // this is form data getting passed through from HTML View
            userFactory.createUser(newUser,function(){ 
              $scope.newUser = {};    // sets input fields to clear.
               // $location.path('/users');
              getUsers();              
            });
    
          }

      }

      function profileController(userFactory, loginFactory, jobFactory, $scope, $location){

      $scope.newJob = {};
      $scope.newUser = {};
      $scope.stacks = [];
      $scope.locations = [];

      function getUsers(){

          userFactory.getUsers(function(data){
              console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.users = data; 
              
             
            })
          
      }
      getUsers();

      function getJobs(){

          jobFactory.getJobs(function(data){
              // console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.jobs = data; // $scope.users makes 'users' object available to be used in the html with ng-repeat. This also gets updated anytime a new user is added.
            })

      }
      getJobs();

      function getStacks(){

          jobFactory.getStacks(function(data){
              // console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.stacks = data; 
              console.log($scope.stacks[0].name)
              $scope.newUser.primaryStack = $scope.stacks[0].name
             
            })
          
      }
      getStacks();

      function getLocations(){

          userFactory.getLocations(function(data){
              console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.locations = data; 
              console.log($scope.locations)
              console.log($scope.locations[0].name)
              console.log($scope.newUser)
              $scope.newUser.primaryLocation = $scope.locations[0].name
             
            })
          
      }
      getLocations();

      $scope.addUser = function(newUser){
          console.log(newUser);
           // this is form data getting passed through from HTML View
            userFactory.createUser(newUser,function(){ 
              $scope.newUser = {};    // sets input fields to clear.
               $location.path('/users');
              getUsers();              
            });
    
          }

      }

      // $scope.login = function(user){
      //       loginFactory.login(user, function(){

      //       loginFactory.getUser(function(user){
      //       console.log(user);
      //       // $location.path('/userUpdate');

      //       })

      //    })
      //   }

      // loginFactory.getUser(function(user){
      //       // console.log(user);
      //       $scope.currentUser = user;
      //   })

      //  console.log($scope.currentUser)


    

    function jobController(jobFactory, $scope, $location){

      $scope.newJob = {};
      $scope.stacks = [];

      function getJobs(){

          jobFactory.getJobs(function(data){
              console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.jobs = data; // $scope.users makes 'users' object available to be used in the html with ng-repeat. This also gets updated anytime a new user is added.
            })

      }
      getJobs();

      function getStacks(){

          jobFactory.getStacks(function(data){
              console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.stacks = data; 
              console.log($scope.stacks[0].name)
              $scope.newJob.primaryStack = $scope.stacks[0].name
             
            })
          
      }
      getStacks();

      $scope.addJob = function(newJob){
          console.log(newJob);
           // this is form data getting passed through from HTML View
            jobFactory.createJob(newJob,function(){ 
              $scope.newJob = {};    // sets input fields to clear.
               // $location.path('/');
              getJobs();              
            });
    
          }

      }
    

    function eventController(eventFactory, $scope){

      function getEvents(){

          eventFactory.getEvents(function(data){
              console.log(data, "this is coming from my factory var customers, it's my hard coded object");
              $scope.events = data; // $scope.users makes 'users' object available to be used in the html with ng-repeat. This also gets updated anytime a new user is added.
            })

      }
      getEvents();

      $scope.addEvent = function(newEvent){
          console.log(newEvent);
           
            jobFactory.createEvent(newEvent,function(){ 
              $scope.newEvent = {};  
               // $location.path('/');
              getEvents();              
            });
    
          }
    }

  </script>
</head>
<body ng-app="alumniApp">

      <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">CodingDojo On Tap</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <form class="navbar-form navbar-right">
            <div class="form-group">
              <input type="text" placeholder="Email" class="form-control">
            </div>
            <div class="form-group">
              <input type="password" placeholder="Password" class="form-control">
            </div>
            <button type="submit" class="btn btn-success">Sign in</button>
          </form>
        </div><!--/.navbar-collapse -->
      </div>
    </nav>

  <div class="container">
    <a href='/login'>Login</a><br>
    <a href='/signup'>Signup</a><br>

  <div ng-view = "">
    this is the ng-view div. Put stuff here!
  </div>

   <hr>

      <footer>
        <p class="text-center">&copy; Mike Bogosian, Pete Kang, Mollie Knute, and Rich Whybrew</p>
      </footer>
    </div> <!-- /container -->


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/static/js/ie10-viewport-bug-workaround.js"></script>
</body>
</html>